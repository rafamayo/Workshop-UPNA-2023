# Lab 2

## Introduction

In this exercise you will set up an example FHIR server, fill it with patient data and do some simple tasks with the server.

For this exercise, the FHIR server runs inside a Docker container. Docker is already installed and ready to use on your virtual machine.

## Download and start the container
Docker is set up on the virtual machine and should start upon login. However, it may take some time until it is ready.

**Note:** The Docker desktop does not need to be started.

Bring up a *Command Prompt Window (cmd)* and run the container:

```bash
docker run -dp 8080:8080 hapiproject/hapi:latest
```

In case that the container is not present on your machine, you can download the latest version of the FHIR server container with the command

```bash
docker pull hapiproject/hapi:latest
```

Now the FHIR Base should be available here:

`http://localhost:8080/fhir/patient`

The response should contain "total": 0 patients. The server is empty!

![The FHIR server is empty](/assets/FHIR_server_empty.png)

Further information about the HAPI FHIR implementation can be found here: https://github.com/hapifhir/hapi-fhir-jpaserver-starter

## Task 1 - Examining our server

First we want to find out what our server can do. We can find out by looking at the response of the metadata request. This is possible directly via the URL: `http://localhost:8080/fhir/metadata` or using a REST client to perform a GET request.

The CapabilityStatement is very long (how many lines?) It is list of all supported resources follows.

1. Look for the following meta information: What is the version of the server?

2. Which status of the FHIR standard is implemented?

A combination of resources that is very common and useful is the triplet `"Patient"/"Encounter"/"Diagnostic Report"`. This combination is used, for example, to model an `Encounter` in which a `Patient` undergoes an examination the result thereof gets documented in a `DiagnosticReport`.

3. Can you find the relevant resources in the capability statement?

In the description of each of these resources there are very interesting fields "searchInclude" and
"searchParam". Why is?
The "searchParam" can be of different types (string, date, token, reference). mean what
these guys? You can find the answers to these questions in the documentation.

Task 2 - Fill our server with patient data
In order to be able to work meaningfully with the server, we have to fill the server with patient data.
There are different possibilities for this. We use synthea to generate sample patients.
https://github.com/synthetichealth/synthea
We use the “Basic Setup and Running instructons”:
https://github.com/synthetichealth/synthea/wiki/Basic-Setup-and-Running
Download the program to your personal drive in a subdirectory "eHealth/Synthea"
down.
https://github.com/synthetichealth/synthea/releases/download/master-
branch-latest/synthea-with-dependencies.jar
3/5Basics of eHealth
Summer semester 2021
Exercise 2 – Set up and fill the FHIR server
Now generate 10 patients with the patient generator. See the page linked above
instructions and examples of how to do this. Use the default settings.
java -jar synthea-with-dependencies.jar -p 10
Note: the patients are generated according to the US profile. It is possible international
use profiles (https://github.com/synthetichealth/synthea-
international). For our current purposes, however, the default settings are sufficient.
Now we have to upload the patients to the server. For this we use a python script
https://gist.github.com/rafamayo/1731e489b114a8cb1ac4c3f8fbc6e9fc
Upload the script to your personal drive in a subdirectory "eHealth/FHIR-uploader"
down.
Caution: Check the "FHIR Server endpoint" and the path to your patient files!
Now you can run the script from the "eHealth/FHIR-uploader" directory.
python upload-fhir-bundle.py
The python package 'requests' must be installed.
If everything was successful, you should now be patient on your local server. Now you can
Carry out exercises from exercise sheet 1 with your own server.

Task 3 - Use a client
There are client implementations for different programming languages. Since we are using python here
worked, we will work with the python client from SMART.
The HAPI Server requires version 4.0.0 of the SMART fhir client, but pip installs version 3.2.0.
The correct version must be installed manually. The repository can be found here:
https://github.com/smart-on-fhir/client-py
Instructions to get the distribution running:
https://github.com/smart-on-fhir/client-py#building-distribution
Then you have to run the following command in the root folder of the package:

python setup.py install
Damit wird die richtige Version installiert. Dies kann mit
pip list
überprüft werden.
Jetzt können Sie die Aufgaben in
https://gist.github.com/rafamayo/1d0873ec3bfc8e2c624fa5259808b8c2
mit Ihrem Server durchführen.


