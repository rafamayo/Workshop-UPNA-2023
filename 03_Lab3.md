# Lab 3

In this lab we will work with the very important FHIR concept of references.

## References in FHIR

References between resources in FHIR always go in one direction only. For example, observations have a reference to the corresponding subject to which the observation applies (e.g. a patient), but the patient has no references to any observations.

This is an optimization because when new observations are made, the patient does not need to be updated. The same applies, for example, to the relationship between doctor and patient: the patient has a reference to the doctor (general practitioner), but the doctor has no reference to his patients.

A resource's possible references can easily be identified in the documentation. For example in the patient's case:

![FHIR references in the documentation](/assets/FHIR_references.png)

## Types of references

In FHIR there are two different types of references: literal and logical (https://www.hl7.org/fhir/references.html#Reference). Basically we can define the two types of references as follows:
+ literal references are references between two well defined FHIR resources, where the URI of both linked resources is known and the system can resolve the resources.
+ logical references are used when the referenced resource may not well known and cannot be readily resolved. For example because the resource resides in a system that does not expose a RESTful API. This might happen when working with legacy systems.

For the purposes of this lab we will work with literal references.

## Search with references

The resource Practitioner does not know her patients (has no reference to her patients). For a particular practitioner, how might we look for her patients? To do this, we look up the documentation for Patient and find the general-practitioner parameter in the Search Parameters section (https://www.hl7.org/fhir/patient.html#search).

We can then do a search like this:

```
GET {{FHIR_URL}}/Patient?general-practitioner=Practitioner/<practitioner id>
```
  
In `<practitioner id>` we put the known id of the resource practitioner. As a result, we get a bundle containing all patients whose practitioner is the indicated one. Of course, we might have to search for the practiotioner first to get her id. Or maybe we obtained her id in some other way (e.g. it was entered in a form).

We can also do chained searches. For example if we knew the name of the practitioner, we could search for all patients whose paractioner has a specific name. A chained search would look like this:

```
GET {{FHIR_URL}}/Patient?general-practitioner:Practitioner.name=<practitioner name>
```

The important idea with the chained search is that the symbol `.` gives access to the search parameters of the referenced resource (in this case the Practioner). So for example we could do this:

```
GET {{FHIR_URL}}/Patient?general-practitioner:Practitioner.id=<practitioner id>
```
which is the same as the first search.

In a chained search we can even combine several search parameters using the symbol `&` as usual.


## A scenario

We want to model the following scenario to try out some of the things we've learned:

![A FHIR scenario](/assets/FHIR_scenario.png)
