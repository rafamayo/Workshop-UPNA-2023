# Lab 1

## Introduction

In this lab we will deal with the FHIR communication standard. FHIR (Fast Healthcare Interoperability Resources) is published by HL7 and is a modern healthcare communication standard that combines the best features of HL7 v2, HL7 v3 and CDA. The standard uses the latest web technologies with a focus on simplicity in implementation.

In this lab we *simulate* an app that
+ can search for and read patient data on an FHIR server
+ can update/supplement patient data on an FHIR server
+ can add new patients to the FHIR server

The exercise has the following learning objectives:
+ read and apply the FHIR specification
+ understand the basics of the FHIR standard
+ identify appropriate resources for a use case
+ create and modify resources
+ interact with an FHIR server via REST
+ use FHIR operations
+ work with terminologies

## Required tools and infrastructure:
+ Web browser
     + Firefox or Chrome
+ REST client
     + For example Postman https://www.postman.com/downloads/
+ Test FHIR Server
     + [List of available test servers](https://confluence.hl7.org/display/FHIR/Public+Test+Servers)
     + For example: http://hapi.fhir.org/baseR4
+ Current version of the FHIR specification
     + http://hl7.org/fhir/

## Task 1 - Selection of appropriate resources for the scenario

In the documentation there is an overview of all available resources: http://hl7.org/implement/standards/fhir/resourcelist.html. These are the modular components which will be assembled into working systems that solve real world clinical and administrative problems in healthcare.

What you should pay attention to when you want to select a specific resource for a use case.  
In our simple use case we want to work with patients, so we will focus on the documentation of the *Patient* resource first: http://hl7.org/implement/standards/fhir/patient.html

All resource documentation pages are organized into modules and have the same basic structure. It is a good idea to start by considering the following aspects when deciding which resource to use: 

+ *Scope and Usage*: describes when and for what the resource should be used. http://hl7.org/implement/standards/fhir/patient.html#scope
+ Examples: provides several possible concrete example implmentations of the resource. http://hl7.org/implement/standards/fhir/patient-examples.html
+ Profiles and extensions: rules and additional information items which might be required in certain scenarios. http://hl7.org/implement/standards/fhir/patient-profiles.html
+ *Maturity level* of the resource: used by implementers to judge how advanced and stable a resource is. http://hl7.org/implement/standards/fhir/resource.html

![An example resource *AllergyIntolerance*](/assets/FHIR_resource_summary_labeled.png)

## Available CRUD Interactions

What interactions are available to implement the scenario.
+ system-related [base]
     + Conformance ( GET ): Read the conformance statement of a system
     + Batch/transaction ( POST ): Process multiple resources in a single interaction
     + History ( GET ): Read the history of all resources
     + Search ( GET ): Search for resources based on a criterion independent of the resource type
+ type-related [base]/[type] ...
     + create ( POST ): Creation of a new resource
     + search ( GET ): Search for resources of a type based on criteria
     + history ( GET ): Retrieve the changes of all resources of a type
+ instance-related [base]/[type]/[id] ...
     + read ( GET ): Read the current version of a resource
     + update ( PUT ): Update/modify a resource
     + delete ( DELETE ): Delete a resource
     + history/vread ( GET ): Read the history or a specific version of a resource
(More information: http://hl7.org/implement/standards/fhir/http.html)

1. Identify appropriate resources for the patient data. Where can you find this information in the documentation?
2. Decide which of the above interactions are required for the scenario


## Task 2 - Searching for resources

There are different ways in which we can perform searches on the resources. We can for example search for all instances of a resource or we can limit the search by using parameters. the syntax is the typical one for HTTP interactions.

To get all the instances of a resource, we just type `[base]/[type]`. If you want to use parameters to narrow down the search, then the general syntax is as follows: 

`[base]/[type]?[parameter1]&[parameter2]&[parameter3]...`

Examples of valid parameters are:
+ length=27
+ height=lt163.00
+ date=ge2013-01-01
+ name:exact=Eva
+ name:contains=eva
+ gender:missing=true
+ gender:not=male
+ value=5.4||mg
+ value=ap5.4|http://unitsofmeasure.org|mg

(More information: http://hl7.org/implement/standards/fhir/search.html)

1. Identify the valid search parameters for the Patient resource. Where can you find this information?
2. Do you test the query [base]/Patient? in the browser. View the results using the HTML XML option
3. Restrict your search: only search for male/female patients
4. Extend the query with the parameter _format=html/xml
5. Test (and save!) the same query in the REST client. Note: With the REST client, no formatting information is required. The formatting is done by the client itself.
6. Configure your REST client with the header `Accept: application/fhir+xml` and save it as a favourite.


## Task 3 - Obtain and analyze search results

Search results are always returned as a *Bundle* resource (type = searchset). The total attribute indicates the number of search hits. The search results (individual resources) are contained in the repeatable attribute 'Bundle.entry.resource'. The address where each resource can be retrieved is in `Bundle.entry.fullUrl`.

### Search results with paging
Servers are free not to return all search results at once for resource reasons. Instead, individual "pages" are created with links to additional results. Clients can specify the page size themselves using the `_count` parameter.

1. Run a search with no parameters `[base]/Patient`
How many results did you get? Is there paging? How many individual results do the pages contain?

2. Run the search again and append the parameter _count=10. Find the `relation` parameter in the results. The possible values of this parameter are `self`, `next`, `previous`. What do you think that these values mean?

3. How many entries do the different groups contain?

4. Search for patients with the last name "Workshop-UPNa" and retrieve the resource by their URL in XML format.

5. What is the difference between the search and read interactions?


## Task 4 - Editing Resources

Primitive data types only have a value, but no further sub-elements (Example?). Complex data types (Example?) have sub-elements (either primitive or complex data types). Both primitive and complex data types can be extended with extensions.
light blue= data types
pink = profiles of data types
Representation in XML: <count value = “2”/>
Representation in JSON: “count”: 2




a) Identify appropriate attributes for the patient's last name and address





b) Apply the XML resource retrieved in the last task to the "Request Body" window. You need to perform the search and copy the content from the "Response Body (raw)" into the "Body (request body)" text box



c) Add Content-Type: application/fhir+xml to the header



d) Expand the resource to include the patient's first name and address. What is the required interaction? (Compare task 1)


## Task 5 - Creating a new resource and filling it with data

a) Create a new empty resource of type Patient. What is the required interaction?
The URL indicates the resource type. In the "Body" field we write the structure of the empty resource.
Everything worked? How do you get access to the newly created resource?





b) Fill in the newly created resource with details of name, gender, address, contact. What interaction do you use for this?




It is also possible to specify the values of various fields when initially creating a resource (using POST).

c) Now create a new patient with POST and with the appropriate information on name, surname, gender, date of birth and addresses


